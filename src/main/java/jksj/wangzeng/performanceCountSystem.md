## 1. 项目背景
我们希望设计开发一个小的框架，能够获取接口调用的各种统计信息，比如，响应时间的最大值（max）、最小值（min）、平均值（avg）、
百分位值（percentile）、接口调用次数（count）、频率（tps） 等，并且支持将统计结果以各种显示格式（比如：JSON 格式、网页格式、
自定义显示格式等）输出到各种终端（Console 命令行、HTTP 网页、Email、日志文件、自定义输出终端等），以方便查看。
 
## 2. 需求分析
### 2.1 功能性需求分析
相对于一大长串的文字描述，人脑更容易理解短的、罗列的比较规整、分门别类的列表信息。显然，刚才那段需求描述不符合这个规律。
我们需要把它拆解成一个一个的“干条条”。拆解之后我写在下面了，是不是看起来更加清晰、有条理？
- 接口统计信息：包括接口响应时间的统计信息，以及接口调用次数的统计信息等
- 统计信息的类型：max min avg percentile count tps等
- 统计信息显示格式： json html 自定义显示格式
- 统计信息显示终端：console email http网页 日志 自定义显示终端
- 统计触发方式：包括主动和被动两种。主动表示以一定的频率定时统计数据，并主动推送到显示终端，比如邮件推送。被动表示用户触发统计，比如用户在网页中选择要统计的时间区间，触发统计，并将结果显示给用户。
- 统计时间区间：框架需要支持自定义统计时间区间，比如统计最近 10 分钟的某接口的 tps、访问次数，或者统计 12 月 11 日 00 点到 12 月 12 日 00 点之间某接口响应时间的最大值、最小值、平均值等。
- 统计时间间隔：对于主动触发统计，我们还要支持指定统计时间间隔，也就是多久触发一次统计显示。比如，每间隔 10s 统计一次接口信息并显示到命令行中，每间隔 24 小时发送一封统计信息邮件。

### 2.2 非功能性需求分析
对于这样一个通用的框架的开发，我们还需要考虑很多非功能性的需求。具体来讲，我总结了以下几个比较重要的方面
- 易用性
- 性能
- 扩展性
- 容错性
- 通用性

## 3. 设计实现
小步快跑、逐步迭代

```
1. 划分职责进而识别出有哪些类
- MetricsCollector类负责提供API，来采集接口请求的原始数据。
- MetricsStorage接口负责原始数据存储，RedisMetricsStorage类实现MetricsStorage接口。这样做是为了今后灵活地扩展新的存储方法，比如用HBase来存储
- Aggregator类负责根据原始数据计算统计数据
- ConsoleReporter类、EmailReporter类分别负责以一定频率统计并发送统计数据到命令行和邮件。至于ConsoleReporter和EmailReporter是否可以抽象出可复用的抽象类，或者抽象出一个公共的接口，我们暂时不确定

2. 定义类及类与类之间的关系
定义类及属性和方法，定义类与类之间的关系

统计显示：
1. 根据给定的时间区间，从数据库中拉取数据
2. 根据原始数据，计算得到统计数据
3. 将统计数据显示到终端(命令行或邮件)
4. 定时触发以上3个过程的执行
```
