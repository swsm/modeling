## 1. 用户用例
- 用户在获取积分的时候，会告知积分的有效期
- 用户在使用积分的时候，会优先使用快过期的积分
- 用户在查询积分明细的时候，会显示积分的有效期和状态(是否过期)
- 用户在查询总可用积分的时候，会排除掉过期的积分

1. 积分赚取和兑换规则
2. 积分消费和兑换规则
3. 积分及其明细查询

## 2. 系统设计
面向对象的设计聚焦在代码层面(主要是针对类)，那系统设计就是聚焦在架构层面(主要是针对模块)，

1. 合理的将功能划分到不同的模块  针对此业务有3中划分方式
```
第一种： 积分赚取渠道及兑换规则、消费渠道及兑换规则的管理和维护(增删改查),不划分到积分系统中，而是放到更上层的营销系统中。
这样积分系统就会变得非常简单，只需要负责增加积分、减少积分、查询积分、查询积分明细等这几个工作
第二种：积分赚取渠道及兑换规则、消费渠道及兑换规则的管理和维护，分散在各个相关业务系统中，比如订单系统、评论系统、签到系统、换购商城、优惠券系统等。还是刚刚那个下订单赚取积分的例子，在这种情况下，用户下订单成功之后，订单系统根据商品对应的积分兑换比例，计算所能兑换的积分数量，然后直接调用积分系统给用户增加积分。
第三种：所有的功能都划分到积分系统中，包括积分赚取渠道及兑换规则、消费渠道及兑换规则的管理和维护。还是同样的例子，用户下订单成功之后，订单系统直接告知积分系统订单交易成功，积分系统根据订单信息查询积分兑换规则，给用户增加积分。

怎么判断哪种模块划分合理呢？实力上，我们可以反过来通过看它是否符合高内聚、低耦合特性来判断。如果一个功能得修改或添加，
经常要跨团队、跨项目、跨系统才能完成，那说明模块划分得不够合理，职责不够清晰，耦合过于严重
倾向于 第一种和第二种
```
2. 设计模块与模块之间得交互关系
比较常见得系统之间得交互方式有两种，一种是同步接口调用，另一种是利用消息中间件异步调用。第一种方式简单直接，第二种方式得解耦
效果更好。   上下层系统之间得调用倾向于通过同步接口，同层之间得调用倾向于异步消息调用，比如营销系统和积分系统是上下层关系，
他们之间就比较推荐使用同步接口调用

3. 设计模块得接口、数据库、业务模型

|积分明细表|credit_transaction|
|----|----|
|id|明细id|
|user_id|用户id|
|channel_id|赚取或消费渠道ID|
|event_id|相关事件ID,比如订单ID、评论ID、优惠券换购交易ID|
|credit|积分(赚取为正值、消费为负值)|
|create_time|积分赚取或消费时间|
|expired_time|积分过期时间|

|接口|参数|返回|
|----|----|----|
|赚取积分|userId channelId eventId credit expiredTime|积分明细ID|
|消费积分|userId channelId eventId credit expiredTime|积分明细ID|
|查询积分|userId|总可用积分|
|查询总积分明细|userId+分页参数|id userId channelId eventId credit createTime expiredTime|
|查询赚取积分明细|userId+分页参数|id userId channelId eventId credit createTime expiredTime|
|查询消费积分明细|userId+分页参数|id userId channelId eventId credit createTime expiredTime|

4. 分层的说明
Repository层只关注数据的读写。Service层只关注业务逻辑，不关注数据的来源。Controller层只关注与外界打交道，数据校验、封装、
格式转换，并不关心业务逻辑。

5. 总结用到的设计原则和思想

|总结用到的设计原则和思想|详述|
|----|----|
|高内聚、低耦合|将不同的功能划分到不同的模块，遵从的划分原则就是尽量让模块本身高内聚、让模块之间松耦合|
|单一职责原则|模块的设计要尽量职责单一，符合单一职责原则。|
|依赖注入|在MVC三层架构的代码实现中，下一层的类通过依赖注入的方式注入到上一层代码中|
|依赖反转原则|在业务系统开发中，spring ioc这样的容器管理对象的创建，生命周期，这就是依赖反转原则|
|基于接口而非实现编程|在MVC架构中，Service层使用Repository层提供的接口，并不关心其底层是依赖的哪种具体的数据库，|
|封装、抽象|分层体现了抽象和封装的设计思想，能够隔离变化，隔离关注点|
|DRY与继承和组合|尽管VO BO Entity存在代码重复，但功能语义不同，并不违反DRY原则，|
|面向对象设计|系统设计的过程可以参照面向对象设计的步骤来做。面向对象设计本质是将合适的代码放到合适的类中。系统设计是将合适的功能放到合适的模块中|
